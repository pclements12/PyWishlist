{# Expects items(list:the items to display), available (boolean: lists available or claimed items), table_id (optional, string: html tag id for the table)  #}
<div id="{{ table_id }}">
    <input class="form-control search" type="text" placeholder="Filter items"/>
    <table class="table table-condensed">
        <thead>
            <tr>
                <th class="col-md-3 sort" data-sort="name">Item</th>
                <th class="col-md-1 "></th>
                {% if not available %}
                <th class="col-md-3 sort asc" data-sort="wisher">Wisher</th>
                <th class="col-md-3 sort" data-sort="giver">Giver</th>
                <th class="col-md-1">Action</th>
                {% else %}
                <th class="col-md-6 sort asc" data-sort="wisher">Wisher</th>
                <th class="col-md-1">Action</th>
                {% endif %}
            </tr>
        </thead>
        <tbody class="list">
        {% if items %}
            {% for item in items %}
            <tr>
                {% include 'wishlist_app/item/item_row.html' %}
            </tr>
            {% endfor %}
            <tr class="no-items" style="display:none">
                 <td class="col-md-3">
                    <i class="fa fa-frown-o fa-fw"></i>No items
                 </td>
             </tr>
        {% else %}
             <tr class="no-items">
                 <td class="col-md-3">
                    <i class="fa fa-frown-o fa-fw"></i>No items
                 </td>
             </tr>
        {% endif %}
        </tbody>
    </table>
    <div id="{{ table_id }}_no_items" class="alert alert-warning" style="display:none;">
        <i class="fa fa-frown-o fa-fw"></i> No items match the search
    </div>
    <script type="text/javascript">

        (function(){
            {% if available %}
            var options = {
                valueNames: [ 'name', 'wisher' ]
            };
            var available = true;
            {% else %}
            var options = {
                valueNames: [ 'name', 'wisher', 'giver' ]
            };
            var available = false;
            {% endif %}

            function checkEmpty(list){
                return function() {
                    $("#{{ table_id }}_no_items").toggle(list.visibleItems.length == 0);
                }
            }

            function handleListEdit(list){
                return function(ev, data){
                    console.log("re-initialize List object {{ table_id }}")
                    list = new List("{{ table_id }}", options);
                    bind();
                }
            }

            function clearSearch(list){
                return function(ev, data){
                    console.log("clear list search {{ table_id }}", data);
                    list.search();
                }
            }

            //make sortable/filterable lists
            var list = new List("{{ table_id }}", options);
            list.on('searchComplete', checkEmpty(list));

            var handleEdit = handleListEdit(list);
            var search = clearSearch(list);

            function bind(){
                console.log("rebind body listeners for claims");
                $("body").off("item:beforeClaim item:claimSuccess item:unclaimSuccess");
                $("body").on("item:beforeClaim", search);
                $("body").on("item:claimSuccess item:unclaimSuccess", handleEdit);
            }
            bind();
        }());

    </script>
</div>


